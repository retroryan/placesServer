#{extends 'main.html' /}
#{set title:'Home' /}

#{set 'moreScripts'}
    <script type="text/javascript">

        var ambigId;
        var ambigPlace;
        var placesMap = {};

        $(function () {
            $.get("getNextPlace.json", function (data) {
                ambigId = data.ambigId;
                ambigPlace = data.ambigPlace;

                $("#ambigPlaceLabel").append(ambigPlace);

                ambigPlaceList = data.ambigPlaceList;

                $.each(ambigPlaceList, function (index, item) {
                    var tableRowStr = '<tr>' + addColumn('<input type="submit" class="btn primary" name="' + index + '" value="Select">');
                    tableRowStr += addColumn(item.fullName);
                    tableRowStr += addColumn(item.altNames);
                    tableRowStr += addColumn(item.types);
                    tableRowStr += addColumn(item.alsoLocatedIn);
                    tableRowStr += addColumn(item.latitude);
                    tableRowStr += addColumn(item.longitude) + "</tr>";
                    $("#nextPlaceTable").append(tableRowStr);
                    placesMap[index] = item;
                });


                $(".btn.primary").bind('click', function() {
                    var index = $(this).attr("name");
                    var place = placesMap[index];

                    submitAmbigChoice(place.id,  place.placeName, place.fullName);
                });

            });
        });

        function addColumn(rowString) {
            if (typeof(rowString) != "undefined") {
                return "<td>" + rowString + "</td>";
            }
            return "<td></td>";
        }


        function submitAmbigChoice(placeId, placeName, placeFullName) {
            //document.storeLabelChoice.setAttribute("method","post");
            addAttribute("ambigId",ambigId);
            addAttribute("ambigPlace",ambigPlace);
            addAttribute("placeId",placeId);
            addAttribute("placeName",placeName);
            addAttribute("placeFullName",placeFullName);

            $("#storeLabelChoice").submit();
        }

        function addAttribute(name, value) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type","hidden");
            hiddenField.setAttribute("name",name);
            hiddenField.setAttribute("value",value);
            $("#storeLabelChoice").append(hiddenField);
        }

    </script>
#{/set}

<div class="content">

    #{if ambigResults}
        <h3>Labeled ${ambigResults.ambigPlace} as "${ambigResults.fullname}"</h3>
        <p></p><p></p><p></p><p></p>
    #{/if}

    <h3>Choose the Best Match For</h3>
    <h1 id="ambigPlaceLabel"></h1>

    <table border="1" id="nextPlaceTable">
        <tr>
            <th>Choice</th>
            <th>Standard name</th>
            <th>Alternate names</th>
            <th>Type</th>
            <th>Also located in</th>
            <th>Latitude</th>
            <th>Longitude</th>
        </tr>



    </table>


    #{form @storeLabelChoice(), id:'storeLabelChoice', method:'post'}

    #{/form}

</div>

